<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generative Resilience Agent (GRA) - AI Climate Adaptation</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #2E7D32;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.2em;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #2E7D32;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        textarea {
            resize: vertical;
        }
        
        small {
            display: block;
            margin-top: 5px;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
        }
        
        .btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #2196F3;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #1976D2;
        }
        
        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .result-card h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .crop-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .scheme-item {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 4px solid #2196F3;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .farm-layout {
            margin-top: 20px;
            text-align: center;
        }
        
        .farm-layout svg {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .nearby-farms {
            margin-top: 20px;
        }
        
        .nearby-farm-item {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #FF9800;
        }
        
        .ai-chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .ai-chat-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        
        .ai-chat-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .ai-chat-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            z-index: 999;
        }
        
        .ai-chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 12px 12px 0 0;
            font-weight: 600;
        }
        
        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .ai-message {
            background: white;
            padding: 10px 15px;
            border-radius: 12px;
            margin: 8px 0;
            border-left: 3px solid #667eea;
        }
        
        .user-message {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 12px;
            margin: 8px 0;
            text-align: right;
            border-right: 3px solid #2196F3;
        }
        
        .ai-chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ddd;
            background: white;
            border-radius: 0 0 12px 12px;
        }
        
        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 10px;
        }
        
        .ai-chat-input button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-chat-panel {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API Configuration
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:8001' 
            : 'https://climate-adaptation-api.herokuapp.com'; // Will be updated with actual backend URL

        // Main App Component
        function ClimateAdaptationApp() {
            const [formData, setFormData] = useState({
                location: '',
                farm_size: '',
                soil_type: '',
                water_source: '',
                current_crops: [],
                budget: '',
                experience_level: '',
                climate_concerns: [],
                adaptation_goals: []
            });
            
            const [results, setResults] = useState(null);
            const [nearbyFarms, setNearbyFarms] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [showAIChat, setShowAIChat] = useState(false);
            const [chatMessages, setChatMessages] = useState([
                { type: 'ai', text: 'Hello! I\'m GRA, your AI farming assistant. Ask me anything about climate adaptation, crops, or government schemes!' }
            ]);
            const [chatInput, setChatInput] = useState('');

            const handleInputChange = (field, value) => {
                setFormData(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            const handleArrayChange = (field, value) => {
                const values = value.split(',').map(v => v.trim()).filter(v => v);
                setFormData(prev => ({
                    ...prev,
                    [field]: values
                }));
            };

            const submitForm = async () => {
                if (!formData.location || !formData.farm_size) {
                    setError('Please fill in location and farm size');
                    return;
                }

                setLoading(true);
                setError('');

                try {
                    const response = await fetch(`${API_BASE}/analyze-climate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            farm_details: {
                                location: formData.location,
                                farm_size: parseFloat(formData.farm_size),
                                soil_type: formData.soil_type,
                                water_source: formData.water_source,
                                current_crops: formData.current_crops,
                                budget: parseFloat(formData.budget) || 0,
                                experience_level: formData.experience_level
                            },
                            climate_concerns: formData.climate_concerns,
                            adaptation_goals: formData.adaptation_goals
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Backend error: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    
                    // Check if Gen AI was used
                    if (!data.ai_powered) {
                        setError('‚ö†Ô∏è Gen AI not configured. Please add OPENAI_API_KEY to backend. See GEN_AI_SETUP.md');
                        return;
                    }
                    
                    console.log('‚ú® Results powered by Gen AI');
                    setResults(data.adaptation_plan);
                    
                    // Also fetch nearby farms
                    fetchNearbyFarms();
                    
                } catch (err) {
                    console.error('Analysis error:', err);
                    setError(`‚ùå Analysis failed: ${err.message}. Please ensure backend is running with Gen AI configured.`);
                } finally {
                    setLoading(false);
                }
            };

            const fetchNearbyFarms = async () => {
                try {
                    const response = await fetch(`${API_BASE}/nearby-farms`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            location: formData.location,
                            radius_km: 10
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        setNearbyFarms(data.nearby_plans || []);
                    }
                } catch (err) {
                    console.error('Failed to fetch nearby farms:', err);
                }
            };

            const generateDemoResults = (formData) => {
                const location = formData.location.toLowerCase();
                const farmSize = parseFloat(formData.farm_size);
                
                // Generate demo results based on location and farm details
                const demoResults = {
                    climate_analysis: {
                        risks: location.includes('maharashtra') ? ['drought', 'irregular_rainfall', 'heat_waves'] : 
                               location.includes('kerala') ? ['flooding', 'excessive_rainfall'] : 
                               ['irregular_rainfall', 'temperature_fluctuations'],
                        urgency_level: 'Medium'
                    },
                    crop_recommendations: {
                        recommended_crops: location.includes('maharashtra') ? ['Cotton', 'Soybean', 'Millets'] :
                                          location.includes('punjab') ? ['Wheat', 'Rice', 'Maize'] :
                                          ['Rice', 'Coconut', 'Spices']
                    },
                    government_schemes: {
                        recommended_schemes: [
                            {
                                name: 'Pradhan Mantri Krishi Sinchai Yojana',
                                subsidy: { amount: 75000 }
                            },
                            {
                                name: 'Soil Health Management Scheme',
                                subsidy: { amount: 15000 }
                            },
                            {
                                name: 'National Mission for Sustainable Agriculture',
                                subsidy: { amount: 50000 }
                            }
                        ]
                    },
                    market_analysis: {
                        market_insights: [
                            'High-value crops identified for your region',
                            'Stable demand for recommended crops',
                            'Good export potential for cotton and spices'
                        ]
                    },
                    implementation_timeline: [
                        {
                            phase: 'Immediate (0-3 months)',
                            actions: ['Soil testing', 'Water source assessment', 'Seed procurement']
                        },
                        {
                            phase: 'Short-term (3-12 months)',
                            actions: ['Plant recommended crops', 'Install irrigation', 'Apply for schemes']
                        },
                        {
                            phase: 'Long-term (1-3 years)',
                            actions: ['Establish perennial crops', 'Build infrastructure', 'Diversify income']
                        }
                    ],
                    estimated_costs: {
                        total_estimated_cost: farmSize * 20000,
                        government_subsidy: farmSize * 8000,
                        farmer_contribution: farmSize * 12000
                    },
                    farm_layout_svg: `<svg width="400" height="300" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
                        <rect width="400" height="300" fill="#f5f5f5" stroke="#ddd"/>
                        <text x="200" y="30" text-anchor="middle" font-family="Arial" font-size="16" font-weight="bold">Demo Farm Layout (${farmSize} acres)</text>
                        <rect x="50" y="50" width="120" height="80" fill="#4CAF50" stroke="#333" stroke-width="2"/>
                        <text x="110" y="95" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Cotton</text>
                        <rect x="200" y="50" width="120" height="80" fill="#FF9800" stroke="#333" stroke-width="2"/>
                        <text x="260" y="95" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Soybean</text>
                        <rect x="50" y="150" width="120" height="80" fill="#795548" stroke="#333" stroke-width="2"/>
                        <text x="110" y="195" text-anchor="middle" font-family="Arial" font-size="12" fill="white">Millets</text>
                        <circle cx="350" cy="200" r="20" fill="#2196F3" stroke="#333" stroke-width="2"/>
                        <text x="350" y="205" text-anchor="middle" font-family="Arial" font-size="10" fill="white">Well</text>
                    </svg>`
                };
                
                return demoResults;
            };

            const generateDemoNearbyFarms = () => {
                return [
                    {
                        location: 'Nearby Village A',
                        farm_size: 3.5,
                        soil_type: 'black',
                        recommended_crops: ['Cotton', 'Soybean'],
                        success_metrics: { climate_resilience: 'High' }
                    },
                    {
                        location: 'Nearby Village B',
                        farm_size: 7.2,
                        soil_type: 'red',
                        recommended_crops: ['Millets', 'Groundnut'],
                        success_metrics: { climate_resilience: 'High' }
                    }
                ];
            };

            const handleAIChat = async () => {
                if (!chatInput.trim()) return;

                const userMessage = chatInput;
                setChatMessages(prev => [...prev, { type: 'user', text: userMessage }]);
                setChatInput('');

                // Add thinking indicator
                setChatMessages(prev => [...prev, { type: 'ai', text: 'ü§î Thinking...' }]);

                try {
                    const response = await fetch(`${API_BASE}/ai-chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            message: userMessage,
                            context: formData 
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Backend not available');
                    }

                    const data = await response.json();
                    
                    // Remove thinking indicator and add real response
                    setChatMessages(prev => {
                        const newMessages = prev.slice(0, -1); // Remove thinking message
                        return [...newMessages, { type: 'ai', text: data.response }];
                    });

                    if (!data.ai_powered) {
                        // Show warning if Gen AI not configured
                        setTimeout(() => {
                            setChatMessages(prev => [...prev, { 
                                type: 'ai', 
                                text: '‚ö†Ô∏è Note: Gen AI not configured. Add OPENAI_API_KEY for better responses.' 
                            }]);
                        }, 1000);
                    }
                    
                } catch (err) {
                    console.error('Chat error:', err);
                    setChatMessages(prev => {
                        const newMessages = prev.slice(0, -1); // Remove thinking message
                        return [...newMessages, { 
                            type: 'ai', 
                            text: '‚ùå Unable to connect to AI backend. Please ensure the backend is running with Gen AI configured.' 
                        }];
                    });
                }
            };

            const generateAIResponse = (message) => {
                const msg = message.toLowerCase();
                
                // Crop-related queries
                if (msg.includes('crop') || msg.includes('plant') || msg.includes('grow')) {
                    return "üåæ For climate-resilient crops, I recommend:\n\n1. **Millets** - Extremely drought-resistant, perfect for water-scarce regions\n2. **Cotton** - Heat-tolerant and suitable for black soil\n3. **Soybean** - Good for crop rotation and nitrogen fixation\n\nWould you like specific recommendations for your location?";
                }
                
                // Climate-related queries
                if (msg.includes('climate') || msg.includes('weather') || msg.includes('drought') || msg.includes('rain')) {
                    return "üå°Ô∏è Climate adaptation strategies:\n\n‚Ä¢ **Water Conservation**: Install drip irrigation and rainwater harvesting\n‚Ä¢ **Soil Health**: Use mulching and organic matter\n‚Ä¢ **Crop Diversification**: Don't rely on single crop\n‚Ä¢ **Early Warning**: Monitor weather forecasts regularly\n\nWhat specific climate challenge are you facing?";
                }
                
                // Scheme-related queries
                if (msg.includes('scheme') || msg.includes('subsidy') || msg.includes('government') || msg.includes('loan')) {
                    return "üèõÔ∏è Top Government Schemes for Farmers:\n\n1. **PM-KISAN** - ‚Çπ6,000/year direct benefit\n2. **PMKSY** - 75% subsidy on irrigation\n3. **Soil Health Card** - Free soil testing\n4. **KCC** - Low-interest farm loans\n\nFill the form above to get personalized scheme recommendations!";
                }
                
                // Market-related queries
                if (msg.includes('market') || msg.includes('price') || msg.includes('sell')) {
                    return "üìà Market Intelligence Tips:\n\n‚Ä¢ Check MSP (Minimum Support Price) before planting\n‚Ä¢ Join Farmer Producer Organizations (FPOs)\n‚Ä¢ Use e-NAM platform for better prices\n‚Ä¢ Consider contract farming for price stability\n\nWhich crop's market info do you need?";
                }
                
                // Water-related queries
                if (msg.includes('water') || msg.includes('irrigation')) {
                    return "üíß Water Management Solutions:\n\n‚Ä¢ **Drip Irrigation**: Save 60% water, get 75% subsidy\n‚Ä¢ **Sprinkler System**: Good for large fields\n‚Ä¢ **Rainwater Harvesting**: Store monsoon water\n‚Ä¢ **Mulching**: Reduce evaporation by 50%\n\nWhat's your current water source?";
                }
                
                // Soil-related queries
                if (msg.includes('soil') || msg.includes('fertilizer')) {
                    return "üå± Soil Health Management:\n\n‚Ä¢ Get free Soil Health Card from Krishi Vigyan Kendra\n‚Ä¢ Use organic manure and compost\n‚Ä¢ Practice crop rotation\n‚Ä¢ Avoid excessive chemical fertilizers\n\nBalanced NPK ratio improves yield by 30%!";
                }
                
                // General help
                if (msg.includes('help') || msg.includes('how') || msg.includes('what')) {
                    return "ü§ñ I'm GRA, your AI farming assistant! I can help with:\n\n‚úÖ Climate-resilient crop selection\n‚úÖ Government schemes & subsidies\n‚úÖ Water & soil management\n‚úÖ Market prices & selling strategies\n‚úÖ Pest control & disease management\n\nJust ask me anything, or fill the form for a complete analysis!";
                }
                
                // Default response
                return "I understand you're asking about: \"" + message + "\"\n\nü§ñ As your AI farming assistant, I can provide detailed guidance on:\n\n‚Ä¢ Climate adaptation strategies\n‚Ä¢ Crop recommendations\n‚Ä¢ Government schemes\n‚Ä¢ Water & soil management\n‚Ä¢ Market intelligence\n\nCould you be more specific about what you'd like to know?";
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>ü§ñ Generative Resilience Agent (GRA)</h1>
                        <p>AI-Powered Climate Adaptation & Agricultural Intelligence Platform</p>
                        <div style={{background: '#e8f5e9', padding: '12px', borderRadius: '8px', marginTop: '15px', fontSize: '14px', border: '1px solid #4CAF50'}}>
                            <strong>‚ú® Powered by AI:</strong> Advanced generative AI for climate analysis, crop recommendations, and personalized farming strategies
                        </div>
                    </div>

                    <div className="main-content">
                        <ClimateForm 
                            formData={formData}
                            onInputChange={handleInputChange}
                            onArrayChange={handleArrayChange}
                            onSubmit={submitForm}
                            loading={loading}
                            error={error}
                        />
                        
                        <NearbyFarms farms={nearbyFarms} />
                    </div>

                    {results && (
                        <div className="results-section">
                            <ResultsDisplay results={results} />
                        </div>
                    )}

                    {/* AI Chat Widget */}
                    <div className="ai-chat-widget">
                        {showAIChat && (
                            <div className="ai-chat-panel">
                                <div className="ai-chat-header">
                                    ü§ñ GRA AI Assistant
                                    <button 
                                        onClick={() => setShowAIChat(false)}
                                        style={{float: 'right', background: 'transparent', border: 'none', color: 'white', cursor: 'pointer', fontSize: '18px'}}
                                    >
                                        ‚úï
                                    </button>
                                </div>
                                <div className="ai-chat-messages">
                                    {chatMessages.map((msg, index) => (
                                        <div key={index} className={msg.type === 'ai' ? 'ai-message' : 'user-message'}>
                                            {msg.text}
                                        </div>
                                    ))}
                                </div>
                                <div className="ai-chat-input">
                                    <input
                                        type="text"
                                        value={chatInput}
                                        onChange={(e) => setChatInput(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAIChat()}
                                        placeholder="Ask me anything..."
                                    />
                                    <button onClick={handleAIChat}>Send</button>
                                </div>
                            </div>
                        )}
                        <button 
                            className="ai-chat-button"
                            onClick={() => setShowAIChat(!showAIChat)}
                        >
                            {showAIChat ? '‚úï Close' : 'ü§ñ AI Assistant'}
                        </button>
                    </div>
                </div>
            );
        }

        // Climate Form Component
        function ClimateForm({ formData, onInputChange, onArrayChange, onSubmit, loading, error }) {
            return (
                <div className="card">
                    <h2>üè° Farm Details & Climate Concerns</h2>
                    
                    <div className="form-group">
                        <div className="form-row">
                            <div>
                                <label>Location (City, State)</label>
                                <input
                                    type="text"
                                    value={formData.location}
                                    onChange={(e) => onInputChange('location', e.target.value)}
                                    placeholder="e.g., Pune, Maharashtra"
                                />
                            </div>
                            <div>
                                <label>Farm Size (acres)</label>
                                <input
                                    type="number"
                                    value={formData.farm_size}
                                    onChange={(e) => onInputChange('farm_size', e.target.value)}
                                    placeholder="e.g., 5"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="form-group">
                        <div className="form-row">
                            <div>
                                <label>Soil Type</label>
                                <select
                                    value={formData.soil_type}
                                    onChange={(e) => onInputChange('soil_type', e.target.value)}
                                >
                                    <option value="">Select soil type</option>
                                    <option value="clay">Clay</option>
                                    <option value="loamy">Loamy</option>
                                    <option value="sandy">Sandy</option>
                                    <option value="black">Black Cotton</option>
                                    <option value="red">Red</option>
                                </select>
                            </div>
                            <div>
                                <label>Water Source</label>
                                <select
                                    value={formData.water_source}
                                    onChange={(e) => onInputChange('water_source', e.target.value)}
                                >
                                    <option value="">Select water source</option>
                                    <option value="borewell">Borewell</option>
                                    <option value="well">Open Well</option>
                                    <option value="river">River/Canal</option>
                                    <option value="rainwater">Rainwater</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div className="form-group">
                        <div className="form-row">
                            <div>
                                <label>Budget (‚Çπ)</label>
                                <input
                                    type="number"
                                    value={formData.budget}
                                    onChange={(e) => onInputChange('budget', e.target.value)}
                                    placeholder="e.g., 100000"
                                />
                            </div>
                            <div>
                                <label>Experience Level</label>
                                <select
                                    value={formData.experience_level}
                                    onChange={(e) => onInputChange('experience_level', e.target.value)}
                                >
                                    <option value="">Select experience</option>
                                    <option value="beginner">Beginner (0-2 years)</option>
                                    <option value="intermediate">Intermediate (3-10 years)</option>
                                    <option value="experienced">Experienced (10+ years)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div className="form-group">
                        <label>Current Crops (comma-separated)</label>
                        <textarea
                            value={formData.current_crops.join(', ')}
                            onChange={(e) => onArrayChange('current_crops', e.target.value)}
                            placeholder="e.g., rice, wheat, cotton, sugarcane"
                            rows="3"
                            style={{minHeight: '70px', resize: 'vertical'}}
                        />
                        <small style={{color: '#666', fontSize: '12px', display: 'block', marginTop: '5px'}}>
                            ‚úèÔ∏è Type multiple crops separated by commas. Example: rice, wheat, cotton
                        </small>
                    </div>

                    <div className="form-group">
                        <label>Climate Concerns (comma-separated)</label>
                        <textarea
                            value={formData.climate_concerns.join(', ')}
                            onChange={(e) => onArrayChange('climate_concerns', e.target.value)}
                            placeholder="e.g., drought, irregular rainfall, heat waves, water scarcity"
                            rows="3"
                            style={{minHeight: '70px', resize: 'vertical'}}
                        />
                        <small style={{color: '#666', fontSize: '12px', display: 'block', marginTop: '5px'}}>
                            ‚úèÔ∏è Type multiple concerns separated by commas. Example: drought, heat waves
                        </small>
                    </div>

                    <div className="form-group">
                        <label>Adaptation Goals (comma-separated)</label>
                        <textarea
                            value={formData.adaptation_goals.join(', ')}
                            onChange={(e) => onArrayChange('adaptation_goals', e.target.value)}
                            placeholder="e.g., increase yield, reduce water usage, improve soil health, climate resilience"
                            rows="3"
                            style={{minHeight: '70px', resize: 'vertical'}}
                        />
                        <small style={{color: '#666', fontSize: '12px', display: 'block', marginTop: '5px'}}>
                            ‚úèÔ∏è Type multiple goals separated by commas. Example: increase yield, save water
                        </small>
                    </div>

                    {error && (
                        <div style={{color: 'red', marginBottom: '15px', padding: '10px', background: '#ffebee', borderRadius: '4px'}}>
                            {error}
                        </div>
                    )}

                    <button 
                        className="btn" 
                        onClick={onSubmit} 
                        disabled={loading}
                    >
                        {loading ? 'Analyzing...' : 'üîç Generate Climate Adaptation Plan'}
                    </button>
                </div>
            );
        }

        // Nearby Farms Component
        function NearbyFarms({ farms }) {
            if (farms.length === 0) {
                return (
                    <div className="card">
                        <h2>üèòÔ∏è Nearby Farm Plans</h2>
                        <p style={{color: '#666', textAlign: 'center', padding: '20px'}}>
                            Submit your farm details to see adaptation plans from nearby farms
                        </p>
                    </div>
                );
            }

            return (
                <div className="card">
                    <h2>üèòÔ∏è Nearby Farm Plans ({farms.length})</h2>
                    <div className="nearby-farms">
                        {farms.map((farm, index) => (
                            <div key={index} className="nearby-farm-item">
                                <strong>{farm.location}</strong> - {farm.farm_size} acres
                                <br />
                                <small>Soil: {farm.soil_type} | Crops: {farm.recommended_crops?.join(', ')}</small>
                                <br />
                                <small style={{color: '#4CAF50'}}>‚úÖ {farm.success_metrics?.climate_resilience} resilience</small>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Results Display Component
        function ResultsDisplay({ results }) {
            if (!results) return null;

            return (
                <div className="card">
                    <h2>üìä Climate Adaptation Plan Results</h2>
                    
                    {results.climate_analysis && (
                        <div className="loading">
                            <div className="spinner"></div>
                            <p>Generating comprehensive climate adaptation plan...</p>
                        </div>
                    )}

                    <div className="results-grid">
                        {/* Climate Analysis */}
                        {results.climate_analysis && (
                            <div className="result-card">
                                <h3>üå°Ô∏è Climate Risk Analysis</h3>
                                <div>
                                    <strong>Identified Risks:</strong>
                                    {results.climate_analysis.risks?.map((risk, index) => (
                                        <div key={index} className="crop-item">
                                            {risk.replace('_', ' ').toUpperCase()}
                                        </div>
                                    ))}
                                </div>
                                <div style={{marginTop: '10px'}}>
                                    <strong>Urgency Level:</strong> 
                                    <span style={{color: results.climate_analysis.urgency_level === 'High' ? 'red' : 'orange'}}>
                                        {results.climate_analysis.urgency_level}
                                    </span>
                                </div>
                            </div>
                        )}

                        {/* Crop Recommendations */}
                        {results.crop_recommendations && (
                            <div className="result-card">
                                <h3>üåæ Recommended Crops</h3>
                                {results.crop_recommendations.recommended_crops?.map((crop, index) => (
                                    <div key={index} className="crop-item">
                                        <strong>{crop}</strong>
                                        <br />
                                        <small>Climate resilient ‚Ä¢ High yield potential</small>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Government Schemes */}
                        {results.government_schemes && (
                            <div className="result-card">
                                <h3>üèõÔ∏è Government Schemes</h3>
                                {results.government_schemes.recommended_schemes?.map((scheme, index) => (
                                    <div key={index} className="scheme-item">
                                        <strong>{scheme.name}</strong>
                                        <br />
                                        <small>Subsidy: ‚Çπ{scheme.subsidy?.amount?.toLocaleString()}</small>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Market Analysis */}
                        {results.market_analysis && (
                            <div className="result-card">
                                <h3>üìà Market Analysis</h3>
                                <div>
                                    <strong>Market Insights:</strong>
                                    {results.market_analysis.market_insights?.map((insight, index) => (
                                        <div key={index} style={{margin: '5px 0', fontSize: '0.9em'}}>
                                            ‚Ä¢ {insight}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Implementation Timeline */}
                        {results.implementation_timeline && (
                            <div className="result-card">
                                <h3>üìÖ Implementation Timeline</h3>
                                {results.implementation_timeline.map((phase, index) => (
                                    <div key={index} style={{marginBottom: '15px'}}>
                                        <strong>{phase.phase}</strong>
                                        <ul style={{marginLeft: '20px', marginTop: '5px'}}>
                                            {phase.actions?.map((action, actionIndex) => (
                                                <li key={actionIndex} style={{fontSize: '0.9em', margin: '3px 0'}}>
                                                    {action}
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Cost Analysis */}
                        {results.estimated_costs && (
                            <div className="result-card">
                                <h3>üí∞ Cost Analysis</h3>
                                <div>
                                    <div><strong>Total Cost:</strong> ‚Çπ{results.estimated_costs.total_estimated_cost?.toLocaleString()}</div>
                                    <div><strong>Government Subsidy:</strong> ‚Çπ{results.estimated_costs.government_subsidy?.toLocaleString()}</div>
                                    <div><strong>Your Contribution:</strong> ‚Çπ{results.estimated_costs.farmer_contribution?.toLocaleString()}</div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Farm Layout SVG */}
                    {results.farm_layout_svg && (
                        <div className="farm-layout">
                            <h3>üó∫Ô∏è Recommended Farm Layout</h3>
                            <div dangerouslySetInnerHTML={{__html: results.farm_layout_svg}} />
                        </div>
                    )}
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<ClimateAdaptationApp />, document.getElementById('root'));
    </script>
</body>
</html>